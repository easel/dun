id: helix
version: "1.0.0"
description: "Helix workflow validation and agent checks"
triggers:
  - type: path-exists
    value: docs/helix
checks:
  - id: helix-state-rules
    description: "Validate Helix workflow progression"
    type: state-rules
    phase: frame
    state_rules: state-rules.yml

  - id: helix-gates
    description: "Validate Helix phase gates"
    type: gates
    phase: frame
    gate_files:
      - gates/01-frame/input-gates.yml
      - gates/01-frame/exit-gates.yml
      - gates/02-design/input-gates.yml
      - gates/03-test/input-gates.yml
      - gates/04-build/input-gates.yml
      - gates/05-deploy/input-gates.yml
      - gates/06-iterate/input-gates.yml

  - id: helix-create-architecture
    description: "Create architecture doc when missing"
    type: agent
    phase: design
    conditions:
      - type: path-exists
        path: docs/helix/01-frame/prd.md
      - type: path-missing
        path: docs/helix/02-design/architecture.md
    inputs:
      - docs/helix/01-frame/prd.md
    prompt: prompts/create-architecture.md
    response_schema: responses/agent-default.json

  - id: helix-create-feature-specs
    description: "Create feature specs when missing"
    type: agent
    phase: frame
    conditions:
      - type: path-exists
        path: docs/helix/02-design/architecture.md
      - type: glob-max-count
        path: docs/helix/01-frame/features/*.md
        expected: 0
    inputs:
      - docs/helix/01-frame/prd.md
      - docs/helix/02-design/architecture.md
    prompt: prompts/create-feature-specs.md
    response_schema: responses/agent-default.json

  - id: helix-align-specs
    description: "Compare PRD, architecture, and feature specs"
    type: agent
    phase: design
    conditions:
      - type: path-exists
        path: docs/helix/01-frame/prd.md
      - type: path-exists
        path: docs/helix/02-design/architecture.md
      - type: glob-min-count
        path: docs/helix/01-frame/features/*.md
        expected: 1
    inputs:
      - docs/helix/01-frame/prd.md
      - docs/helix/02-design/architecture.md
      - docs/helix/01-frame/features/*.md
    prompt: prompts/align-specs.md
    response_schema: responses/agent-default.json
